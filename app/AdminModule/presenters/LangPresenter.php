<?phpnamespace App\AdminModule\Presenters;use Nette\Application\UI\Form;/** * Prezenter pre spravu jazykov. * * Posledna zmena(last change): 25.11.2015 * * Modul: ADMIN * * @author Ing. Peter VOJTECH ml. <petak23@gmail.com> * @copyright  Copyright (c) 2012 - 2015 Ing. Peter VOJTECH ml. * @license * @link       http://petak23.echo-msz.eu * @version 1.0.3 */class LangPresenter extends \App\AdminModule\Presenters\BasePresenter {  /** @var array kontrola jazykovych nastaveni */  private $kontrola = array('sk'=>array('final'=>TRUE));  private function kontrolujUdaj($pole, $skratka, $comment) {		$nazov_polozky = $pole.'-'.$skratka;     $polozka = $this->udaje->findOneBy(array('nazov'=>$nazov_polozky));    if (!isset($polozka->id)) {      $this->kontrola[$skratka]['final'] = FALSE;      $this->udaje->pridaj(array(          'id_registracia'=> $this->ur_reg['spravca'],          'nazov'         => $nazov_polozky,          'comment'       => $comment.' pre jazyk:'.$skratka,      ));      $odkaz = $this->link('Udaje:');      $this->kontrola[$skratka]['komentar'][] = 'Nebolo vytvorené pole <strong>'.$nazov_polozky.'</strong> v tabulke údaje. Pole bolo vytvorené, ale je prázdne. <a href="'.$odkaz.'" title="Údaje">Môžete ho vyplniť tu!</a>';    } elseif ($polozka->text == NULL) {      $this->kontrola[$skratka]['final'] = FALSE;      $odkaz = $this->link('Udaje:');      $this->kontrola[$skratka]['komentar'][] = 'Nie je vyplnené pole <strong>'.$nazov_polozky.'</strong> v tabulke údaje.                                          <a href="'.$odkaz.'" title="Údaje">Môžete zmeniť tu!</a>';    }  }  private function kontrolujHlavneMenu($lang) {    $menu = $this->hlavne_menu->findAll();        foreach ($menu as $pol) {      if ($this->hlavne_menu_lang->findOneBy(array('id_lang'=>$lang->id, 'id_hlavne_menu'=>$pol->id)) === FALSE){        $this->kontrola[$lang->skratka]['final'] = FALSE;        $odkaz = $this->link('Menu:edit', array("id"=>$pol->id));        if (($nchp = $this->hlavne_menu_lang->findOneBy(array('id_lang'=>1, 'id_hlavne_menu'=>$pol->id))) !== FALSE ){          $tmp_hlasenie = $nchp->nazov;        } else {          $tmp_hlasenie = $pol->id;        }        $this->kontrola[$lang->skratka]['komentar'][] = 'Nebola nájdená jazyková mutácia pre položku hlavného menu:<strong> '                            .$tmp_hlasenie.'</strong>. <a href="'.$odkaz.'" title="Menu">Môžete ho vyplniť tu!</a>';      }    }  }  public function actionDefault() {    //kontrola    $jaz = $this->lang->findAll();    $this->kontrola = array();    $polia = array(      'titulka' => 'Názov zobrazený v titulke',      'log_out' => 'Text pre odkaz na odhlásenie sa',      'log_in'  => 'Text pre odkaz na prihlásenie sa',      'forgot_password' => 'Text pre odkaz na zabudnuté heslo',      'register'  => 'Text pre odkaz na registráciu',      'keywords'  => 'Kľúčové slová',      'no_exzist' => 'Text ak položka v danom jazyku neexzistuje',      'last_update' => 'Text pre odkaz na poslednú aktualizáciu',      'spravca' => 'Text pre odkaz na správcu',			'nazov_uvod' => 'Text pre odkaz na východziu stránku',    );    foreach ($jaz as $j) {        $skratka = $j->skratka;        $this->kontrola[$skratka]['final'] = TRUE; //Prednastavena hodnota        //Kontrola udajov        foreach ($polia as $po => $va){          $this->kontrolujUdaj($po, $skratka, $va);        }        if ($j->skratka != 'sk') $this->kontrolujHlavneMenu($j); //Nekontroluj slovencinu pri hl. menu        if ($this->kontrola[$skratka]['final'] === FALSE){ //Opakovana kontrola neuspesna          $this->lang->oprav($j->id, array('prijaty'=>NULL));        } else { //Uspesna kontrola					//Ak este nie je akceptovany akceptuj.					if ($j->prijaty == 0) $this->lang->oprav($j->id, array('prijaty'=>1));				}    }  }  public function renderDefault() {		$this->template->jazyky = $this->lang->findAll();    $this->template->kontrola = $this->kontrola;	}	public function actionAdd() {		$this->template->h2 = 'Pridanie jazyka';    $this->setView('edit');	}  /**   * Akcia pre editaciu jazyka   * @param int $id Id editovaneho jazyka   */	public function actionEdit($id) {    if (($jazyk = $this->lang->find((int)$id)) === FALSE) {      $this->setView('notFound');    } else {       $this->template->h2 = 'Editácia jazyka: '.$jazyk->nazov;      $this["langEditForm"]->setDefaults($jazyk);    }	}	/**	 * Edit language form component factory.	 * @return Nette\Application\UI\Form	 */	protected function createComponentLangEditForm() {		$form = new Form();		$form->addProtection();    $form->addHidden('id');		$form->addText('skratka', 'Skratka:', 3, 3)				 ->addRule(Form::MIN_LENGTH, 'Skratka musí mať spoň %d znaky!', 2)				 ->setRequired('Skratka musí byť zadaná!');		$form->addText('nazov', 'Miestny názov:', 15, 15)         ->addRule(Form::MIN_LENGTH, 'Miestny názov musí mať spoň %d znaky!', 2)         ->setRequired('Skratka musí byť zadaná!');		$form->addText('nazov_en', 'Anglický názov:', 15, 15)         ->addRule(Form::MIN_LENGTH, 'Anglický názov musí mať spoň %d znaky!', 2);    $form->addSubmit('uloz', 'Ulož')         ->setAttribute('class', 'btn btn-success')         ->onClick[] = array($this, 'langEditFormSubmitted');    $form->addSubmit('cancel', 'Cancel')->setAttribute('class', 'btn btn-default')         ->setValidationScope(array())         ->onClick[] = array($this, 'formCancelled');		return $form;	}	public function langEditFormSubmitted($button) {		$values = $button->getForm()->getValues(); 				//Nacitanie hodnot formulara    $id_pol = (int)$values->id;// Ak je == 0 tak sa pridava    unset($values->id);    $uloz = $this->lang->uloz($values, $id_pol);    if (isset($uloz['id'])) { //Ulozenie v poriadku      $this->flashRedirect('Lang:','Jazyk bol úspešne uložený!', 'success');    } else {													//Ulozenie sa nepodarilo      $this->flashMessage('Došlo k chybe a jazyk sa neuložil. Skúste neskôr znovu...', 'danger');    }	}  /*********** signal processing ***********/  public function handleAkceptuj($id) {    $this->lang->oprav($id, array('prijaty'=>1));		$this->redirect('this');	}    /** Spolocna obluha formularov pri stornovani formulara */	public function formCancelled() {		$this->redirect('Lang:');	}}